<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no, width=device-width">
    <title>图片图层</title>
    <script type="text/javascript">
        window._AMapSecurityConfig = {
            securityJsCode: "5532bc203fa1693f6780cfafcdcbbafb",
        };
    </script>
    <script src="https://webapi.amap.com/maps?v=2.0&key=c3dd92f447429606c242fd5fe4f561c3&plugin=AMap.Walking"></script>
    <script type="text/javascript" src="https://cache.amap.com/lbs/static/addToolbar.js"></script>
    <style>
        /* #container {
            margin: auto;
            padding: 0;
            width: 50vw;
            height: 50vh;
            transform: translate(0, 50%);

        } */
        html,
        body {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        #container {
            width: 100%;
            height: 100vh;
        }

        .btns {
            position: absolute;
            left: 20px;
            bottom: 20px;
            display: flex;
            z-index: 9999;
        }

        .btn {
            text-align: center;
            padding: 20px;
            background-color: aqua;
            border-radius: 10px;
            cursor: pointer;
            margin-right: 20px;
            color: red;
        }
    </style>
</head>

<body>
    <div id="container">
        <div class="btns">
            <div class="btn addbtn">添加标记点</div>
            <div class="btn removebtn">清除标记点</div>
            <!-- <div class="btn" id="lock-bounds">
            限定地图显示范围
        </div>
        <div class="btn" id="unlock-bounds">
            取消地图显示限制
        </div> -->
        </div>
        <div id="panel"></div>
    </div>


    <script>

        var markerData = [
            [116.341503, 39.941005],
            [116.341324, 39.941534],
            [116.340315, 39.94073],
            [116.340309, 39.939556],
            [116.332535, 39.942607],
            [116.331526, 39.942537],
            [116.331889, 39.941369],
            [116.335068, 39.940974],
            [116.335068, 39.940974],
            [116.332737, 39.943551],
            [106.508201, 29.61656],
            [106.509601, 29.617535]
        ]
        var imageLayer = new AMap.ImageLayer({
            url: 'https://amappc.cn-hangzhou.oss-pub.aliyun-inc.com/lbs/static/img/dongwuyuan.jpg',
            bounds: new AMap.Bounds(
                [116.327884, 39.938253],
                [116.342937, 39.946544]
            ),
            zooms: [10, 19],
            // opacity: 0.5
        });

        var map = new AMap.Map('container', {
            center: [116.33679962158203, 39.9420051574707],
            zooms: [10, 19],
            layers: [
                AMap.createDefaultLayer(),
                imageLayer,
            ],
            viewMode: '3D',
            pitch: 40,
            features: ['bg', 'road']
        });

        //保存创建的marker
        let markers = []
        // let circles = []
        // 将标记点添加到地图上
        let btn = document.querySelector('.addbtn')
        btn.addEventListener('click', () => {
            map.remove(markers)
            markerData.forEach(item => {
                let marker = new AMap.Marker({
                    position: item,
                    // offset: new AMap.Pixel(-10, -10),
                });
                // 创建一个透明的圆形覆盖物
                // var circle = new AMap.Circle({
                //     center: item,
                //     radius: 20, // 半径，单位：米
                //     // fillColor: 'transparent',
                //     // strokeColor: 'transparent',
                //     fillColor: 'red',
                //     strokeColor: 'red',
                // });

                marker.on('click', function () {
                    // 在点击事件的处理函数中，缩放并定位到标记点

                    walking(marker.getPosition())
                    // map.setZoomAndCenter(18, marker.getPosition());


                });


                // map.add(circle)
                map.add(marker);
                markers.push(marker)
                // circles.push(circle)
            });
        })

        var currentPosition = null
        //步行路线规划导航
        function walking(endPosition) {
            //步行导航
            let walking = new AMap.Walking({
                map: map,
                panel: "panel"
            });
            //根据起终点坐标规划步行路线
            walking.search(currentPosition, endPosition, function (status, result) {
                // result即是对应的步行路线数据信息，相关数据结构文档请参考  https://lbs.amap.com/api/javascript-api/reference/route-search#m_WalkingResult
                if (status === 'complete') {
                    console.log('绘制步行路线完成')

                } else {
                    console.error('步行路线数据查询失败' + result)
                }
            });
        }

        function getPosition() {
            //获取定位信息
            var options = {
                'showButton': true,//是否显示定位按钮
                'position': 'LT',//定位按钮的位置
                /* LT LB RT RB */
                'offset': [10, 20],//定位按钮距离对应角落的距离
                'showMarker': true,//是否显示定位点
                'markerOptions': {//自定义定位点样式，同Marker的Options
                    'offset': new AMap.Pixel(-18, -36),
                    'content': '<img src="https://a.amap.com/jsapi_demos/static/resource/img/user.png" style="width:36px;height:36px"/>'
                },
                'showCircle': true,//是否显示定位精度圈
                'circleOptions': {//定位精度圈的样式
                    'strokeColor': '#0093FF',
                    'noSelect': true,
                    'strokeOpacity': 0.5,
                    'strokeWeight': 1,
                    'fillColor': '#02B0FF',
                    'fillOpacity': 0.25
                }
            }

            AMap.plugin(["AMap.Geolocation"], function () {
                var geolocation = new AMap.Geolocation(options);
                map.addControl(geolocation);
                geolocation.watchPosition(function (status, result) {
                    if (status == 'complete') {
                        currentPosition = result.position
                        console.log('定位成功')
                    } else {
                        console.log('定位失败')
                    }
                })
            });
        }
        getPosition()

        // 清除 marker
        let removeBtn = document.querySelector('.removebtn')
        removeBtn.addEventListener('click', () => map.remove(markers))

        //限制地图显示范围
        // function lockMapBounds() {
        //     var bounds = new AMap.Bounds(
        //         [116.325367, 39.935626],
        //         [116.345236, 39.950745]
        //     );
        //     map.setLimitBounds(bounds);
        //     // logMapInfo();
        // }

        // //取消地图显示限制
        // function unlockMapBounds() {
        //     map.clearLimitBounds();
        //     // logMapInfo();
        // }

        // //启用地图范围限定
        // lockMapBounds();
        // logMapInfo();

        // 这是一个表示矩形区域四个角的经纬度坐标数组
        var path = [
            [116.327812, 39.942785], // 西南角
            [116.3279, 39.942792],// 西北角
            [116.328727, 39.943189], // 东北角
            [116.328915, 39.943201],  // 东南角
            [116.328903, 39.943399], // 西南角
            [116.328934, 39.943472],// 西北角
            [116.329526, 39.943565], // 东北角
            [116.329503, 39.943728]
            [116.330397, 39.943831], // 西南角
            [116.330513, 39.944013],// 西北角
            [116.330592, 39.944053], // 东北角
            [116.331242, 39.944106]
            [116.331489, 39.944182], // 西南角
            [116.332053, 39.944252],// 西北角
            [116.332294, 39.944241], // 东北角
            [116.332436, 39.944268]
            [116.333311, 39.944241], // 西南角
            [116.333311, 39.944241],// 西北角
            [116.333538, 39.945194], // 东北角
            [116.335126, 39.945349]
            [116.335228, 39.944813], // 西南角
            [116.336278, 39.944877],// 西北角
            [116.337558, 39.945053], // 东北角
            [116.33751, 39.945403],
            [116.338879, 39.94551], // 西南角
            [116.339707, 39.946312],// 西北角
            [116.339546, 39.947512], // 东北角
            [116.340558, 39.947559]
            [116.3407, 39.946518], // 西南角
            [116.340686, 39.946344],// 西北角
            [116.340518, 39.946182], // 东北角
            [116.340547, 39.946012]
            [116.341043, 39.946027], // 西南角
            [116.341053, 39.945805],// 西北角
            [116.341553, 39.945849], // 东北角
            [116.342563, 39.945858]
            [116.34257, 39.943903], // 西南角
            [116.342513, 39.943248],// 西北角
            [116.343181, 39.943081], // 东北角
            [116.343345, 39.942413],
            [116.343113, 39.942394]
            [116.343019, 39.941276], // 西南角
            [116.34269, 39.941176],// 西北角
            [116.342714, 39.938742], // 东北角
            [116.335884, 39.938419],
            [116.33584, 39.93843], // 西南角
            [116.335734, 39.938801],// 西北角
            [116.335627, 39.939425], // 东北角
            [116.335598, 39.939573]
            [116.334039, 39.939484], // 西南角
            [116.33081, 39.939503],// 西北角
            [116.330742, 39.938638], // 东北角
            [116.330432, 39.938701]
            [116.330486, 39.939339], // 西南角
            [116.330147, 39.939952],// 西北角
            [116.32899, 39.940078], // 东北角
            [116.328491, 39.940891]
            [116.327838, 39.942598], // 西南角
            [116.327707, 39.942747],// 西北角
            [116.343181, 39.943081], // 东北角
            [116.343345, 39.942413]
        ];

        // map.setMask([path]); // 设置 mask 路径


        // AMap.plugin(['AMap.ControlBar', 'AMap.ToolBar'], function () { //异步加载插件
        //     var controlBar = new AMap.ControlBar({ //控制地图旋转插件
        //         position: {
        //             right: '10px',
        //             top: '10px'
        //         }
        //     });
        //     map.addControl(controlBar);
        //     var toolBar = new AMap.ToolBar({ //地图缩放插件
        //         position: {
        //             right: '40px',
        //             top: '110px'
        //         }
        //     });
        //     map.addControl(toolBar)
        // });
    </script>
</body>

</html>